{% extends 'clothing/base.html' %}
{% load static %}
{% block title %} lowCost - {% endblock title %}
{% block content %}
        <h2>Complete Checkout</h2>
        <div class="cloth-list">
            {% for item in cart_items %}
            <div class="cloth">
                <!-- <img src="{{ item.get_underlying_image }}" alt=""> -->
                <h4>{{ item }}</h4>
                <span class="quantity-wrap">
                    <p>quantity --> {{ item.quantity }}</p>
                </span>
                <p>total price -->
                    <span class="total-price">{{ item.total_price }}</span></p>
            </div>
            {% endfor %}
        </div>
 
        <div class="checkout-container">
            <p id="total-amount" style="color: green; margin-bottom: 18px;"></p>
            <a href="" id="checkout-btn">Complete Checkout</a>
        </div>

        <script src="https://js.stripe.com/v3/"></script>
        <script type="text/javascript">
            console.log("hello")

            // Calculate the total of all products
            // -----------------------------------
            // -----------------------------------
            let totalPrices = document.querySelectorAll('span.total-price');
            let total = 0
            totalPrices.forEach(element => {
                total += parseInt(element.innerText);
            });
            document.getElementById('total-amount').innerText = "Total Cost  is " + total;


            // Compute stripe checkout
            // -------------------------------------
            // -------------------------------------
            var stripe = Stripe('pk_test_KwO4rG9zqtw63WxHcUsq3SE600XbJ2wyLv');
            let id = '{{ CHECKOUT_SESSION_ID }}'
            console.log(id)

            document.getElementById('checkout-btn').addEventListener('click', () => {
                console.log("clicked")

                stripe.redirectToCheckout({
                  // Make the id field from the Checkout Session creation API response
                  // available to this file, so you can provide it as parameter here
                  // instead of the {{CHECKOUT_SESSION_ID}} placeholder.
                  sessionId: '{{CHECKOUT_SESSION_ID}}'
                }).then(function (result) {
                  // If `redirectToCheckout` fails due to a browser or network
                  // error, display the localized error message to your customer
                  // using `result.error.message`.
                  console.log(result.error.message)
                });
            })
        </script>
{% endblock content %}
